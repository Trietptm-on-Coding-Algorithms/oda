import dns
import logging

logger = logging.getLogger(__name__)


def lookup_malware(binary):
    malware = False
    # lookup in malware hash registry
    try:
        [cymru_record, ] = dns.resolver.query('%s.malware.hash.cymru.com' % binary.md5(), 'TXT')
        malware = True
        logger.info('cymru is %s' % cymru_record)
    # if the name does not exist, this binary is not recognized as malware
    except dns.resolver.NXDOMAIN:
        pass
    # Timeout should not ever happen, but sometimes it does
    # TODO: Indicate to the user, that it is unknowne
    except AttributeError:
        pass
    except dns.resolver.Timeout:
        pass
    except dns.resolver.NoNameservers:
        pass
    except ValueError as e:
        logger.info('Failed to read malware' + str(e))
    return malware
